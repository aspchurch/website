<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if page.title %}{{ page.title }} - {% endif %}{{ site.title }}</title>
    <meta name="description" content="{{ page.description | default: site.description }}">
    <meta name="keywords" content="presbyterian church Carlsbad, North Country presbyterian church, reform church carlsbad, North Country reform church, church plant Carlsbad, North Country church plant, PCA church Carlsbad, reformed worship Carlsbad">

    <!-- SEO and Social Media Meta Tags -->
    <meta name="author" content="{{ site.church.name }}">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="{{ page.url | absolute_url }}">

    <!-- Open Graph Tags for Social Media -->
    <meta property="og:site_name" content="{{ site.church.name }}">
    <meta property="og:title" content="{% if page.title %}{{ page.title }} - {% endif %}{{ site.title }}">
    <meta property="og:description" content="{{ page.description | default: site.description }}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ page.url | absolute_url }}">
    <meta property="og:image" content="{{ '/assets/images/cross1.png' | absolute_url }}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:locale" content="en_US">

    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{% if page.title %}{{ page.title }} - {% endif %}{{ site.title }}">
    <meta name="twitter:description" content="{{ page.description | default: site.description }}">
    <meta name="twitter:image" content="{{ '/assets/images/cross1.png' | absolute_url }}">

    <!-- Church-specific structured data -->
    <meta name="geo.region" content="US-CA">
    <meta name="geo.placename" content="Carlsbad, North County, California">
    <meta name="geo.position" content="33.1445;-117.2862">
    <meta name="ICBM" content="33.1445, -117.2862">

    <!-- Local business structured data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Church",
        "name": "All Saints Presbyterian Church",
        "description": "A new church plant serving North County San Diego",
        "address": {
            "@type": "PostalAddress",
            "streetAddress": "6600 Black Rail Rd",
            "addressLocality": "Carlsbad",
            "addressRegion": "CA",
            "postalCode": "92011",
            "addressCountry": "US"
        },
        "geo": {
            "@type": "GeoCoordinates",
            "latitude": 33.1445,
            "longitude": -117.2862
        },
        "telephone": "",
        "url": "{{ site.url }}{{ site.baseurl }}",
        "sameAs": [],
        "openingHours": "Su 17:00-18:30",
        "hasOfferingCatalogue": {
            "@type": "OfferCatalog",
            "name": "Church Services",
            "itemListElement": [
                {
                    "@type": "Offer",
                    "itemOffered": {
                        "@type": "Service",
                        "name": "Sunday Worship Service",
                        "description": "Presbyterian worship service with biblical preaching and reformed liturgy"
                    }
                }
            ]
        }
    }
    </script>

    <!-- Resource Hints for Performance -->
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Preload Critical Assets -->
    <link rel="preload" href="{{ '/assets/images/logo.png' | relative_url }}" as="image" type="image/png">
    {% if site.performance.enable_css_cache_busting %}
    <link rel="preload" href="{{ '/assets/css/style.css' | relative_url }}?v={{ site.time | date: '%s' }}" as="style">
    {% else %}
    <link rel="preload" href="{{ '/assets/css/style.css' | relative_url }}" as="style">
    {% endif %}

    <!-- Optimized Google Fonts Loading -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@400;600;700&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Lora:ital,wght@0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">

    <!-- Critical CSS (inline for performance) -->
    <style>
        :root{--navy:#1a365d;--blue:#4299e1;--color-primary:#1a2e1a;--color-primary-light:#2d4a2d;--light-blue:#90cdf4;--gray-50:#f7fafc;--gray-100:#edf2f7;--gray-800:#2d3748}
        *,*::before,*::after{box-sizing:border-box}
        body{font-family:'Lora',Georgia,serif;margin:0;padding:0;background:var(--gray-100);line-height:1.6;color:var(--gray-800)}
        a{color:var(--color-primary-light);transition:color 0.3s ease;text-decoration:none}
        a:hover{color:var(--color-primary)}
        .site-header{background:#fff;box-shadow:0 2px 4px rgba(0,0,0,0.05);position:sticky;top:0;z-index:1000}
        .navbar{padding:1rem 0}.nav-container{max-width:1200px;margin:0 auto;padding:0 2rem;display:flex;justify-content:space-between;align-items:center}
        .nav-logo{display:flex;align-items:center;text-decoration:none;color:var(--navy);font-weight:600;font-size:1.125rem}
        .logo{margin-right:0.75rem;border-radius:50%}
        .hero-section{background:#f8f9fa;color:var(--color-primary);text-align:center;padding:6rem 2rem 5rem;position:relative;overflow:hidden;display:flex;flex-direction:column;justify-content:center;align-items:center}
        .hero-title{font-family:'Playfair Display',Georgia,serif;font-size:clamp(2rem,5vw,3.5rem);font-weight:700;margin:0 0 1rem;text-shadow:0 2px 4px rgba(0,0,0,0.1)}
        .hero-subtitle{font-size:clamp(1rem,3vw,1.5rem);margin:0 0 2rem;opacity:0.95;max-width:600px}
        .hero-buttons{display:flex;gap:1rem;margin-bottom:3rem;flex-wrap:wrap;justify-content:center}
        .btn{display:inline-block;padding:0.875rem 2rem;border-radius:8px;text-decoration:none;font-weight:500;transition:all 0.3s ease;border:2px solid transparent}
        .btn-primary{background:var(--color-primary);color:white;border-color:var(--color-primary);font-weight:700}
        .btn:not(.btn-primary){background:rgba(26,46,26,0.1);color:var(--color-primary);border-color:var(--color-primary);backdrop-filter:none}
        .hero-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:2rem;max-width:800px;width:100%}
        .hero-card{background:rgba(255,255,255,0.1);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.2);border-radius:16px;padding:2rem;text-align:center}
        @media (max-width:768px){.nav-container{padding:0 1rem}.hero-section{padding:4rem 1rem 3rem}.hero-cards{grid-template-columns:1fr;gap:1rem}.hero-card{padding:1.5rem}}
    </style>

    <!-- CSS Loading Strategy -->
    {% if site.performance.enable_css_cache_busting %}
    <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}?v={{ site.time | date: '%s' }}">
    {% else %}
    <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">
    {% endif %}

    <!-- Favicons -->
    <link rel="icon" type="image/png" href="{{ '/assets/images/favicon.png' | relative_url }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ '/assets/images/favicon.png' | relative_url }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ '/assets/images/favicon.png' | relative_url }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ '/assets/images/favicon.png' | relative_url }}">
    <link rel="manifest" href="{{ '/assets/images/site.webmanifest' | relative_url }}">
</head>
<body>
    <header class="site-header">
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-logo">
                    <a href="{{ '/' | relative_url }}">
                        <img src="{{ '/assets/images/logo.png' | relative_url }}"
                             alt="{{ site.church.name }} Logo"
                             class="logo"
                             width="40"
                             height="40"
                             loading="eager">
                        <span class="church-name">{{ site.church.name }}</span>
                    </a>
                </div>

                <button class="mobile-menu-toggle" aria-label="Toggle mobile menu" aria-expanded="false">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>

                <ul class="nav-menu">
                    <li><a href="{{ '/about/' | relative_url }}">About</a></li>
                    <li><a href="{{ '/leadership/' | relative_url }}">Leadership</a></li>
                    <li><a href="{{ '/what-we-believe/' | relative_url }}">Beliefs</a></li>
                    <li><a href="https://give.tithe.ly/?formId=44c35121-6cb3-40c6-89d2-bc4305ee1703" target="_blank" rel="noopener noreferrer">Give</a></li>
                </ul>
            </div>
            <div class="mobile-overlay"></div>
        </nav>
    </header>

    <main class="main-content">
        {{ content }}
    </main>

    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-grid">
                <div class="footer-section">
                    <h4 class="footer-title">Worship With Us</h4>
                    <p class="footer-info">
                        <strong>Sundays at 5:00 PM</strong><br>
                        6600 Black Rail Rd<br>
                        Carlsbad, CA 92011<br>
                        <a href="{{ '/meeting-time/' | relative_url }}" class="footer-link footer-cta-link">→ Plan Your Visit</a>
                    </p>
                </div>

                <div class="footer-section">
                    <h4 class="footer-title">Connect</h4>
                    <p class="footer-info">
                        <a href="mailto:info@aspchurch.com" class="footer-link">info@aspchurch.com</a><br>
                        <a href="https://www.instagram.com/allsaintspresbyterianchurch/" target="_blank" rel="noopener noreferrer" class="footer-link footer-social-link" aria-label="Instagram">
                            <svg class="footer-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                                <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                                <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                            </svg>
                        </a>
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Service Worker Registration -->
    {% if site.performance.enable_service_worker %}
    <script>
        // Register service worker for offline functionality
        if ('serviceWorker' in navigator && window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('{{ "/sw.js" | relative_url }}')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(function(error) {
                        console.log('ServiceWorker registration failed: ', error);
                    });
            });
        } else if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            console.log('ServiceWorker disabled in development mode');
        }
    </script>
    {% else %}
    <!-- ServiceWorker disabled via _config.yml performance.enable_service_worker -->
    {% endif %}

    <!-- Performance Monitoring & Core Web Vitals -->
    <script>
        // Performance timing and Core Web Vitals monitoring
        window.addEventListener('load', function() {
            if ('performance' in window) {
                const perfData = performance.timing;
                const loadTime = perfData.loadEventEnd - perfData.navigationStart;
                console.log('Page load time:', loadTime + 'ms');

                // Core Web Vitals monitoring
                if ('PerformanceObserver' in window) {
                    // Largest Contentful Paint (LCP)
                    new PerformanceObserver((entryList) => {
                        const entries = entryList.getEntries();
                        const lastEntry = entries[entries.length - 1];
                        console.log('LCP:', Math.round(lastEntry.startTime), 'ms');
                    }).observe({ entryTypes: ['largest-contentful-paint'] });

                    // First Input Delay (FID)
                    new PerformanceObserver((entryList) => {
                        for (const entry of entryList.getEntries()) {
                            console.log('FID:', Math.round(entry.processingStart - entry.startTime), 'ms');
                        }
                    }).observe({ entryTypes: ['first-input'] });

                    // Cumulative Layout Shift (CLS)
                    let clsValue = 0;
                    new PerformanceObserver((entryList) => {
                        for (const entry of entryList.getEntries()) {
                            if (!entry.hadRecentInput) {
                                clsValue += entry.value;
                            }
                        }
                        console.log('CLS:', Math.round(clsValue * 1000) / 1000);
                    }).observe({ entryTypes: ['layout-shift'] });

                    // Time to First Byte (TTFB)
                    const ttfb = perfData.responseStart - perfData.navigationStart;
                    console.log('TTFB:', ttfb + 'ms');

                    // DOM Content Loaded
                    const dcl = perfData.domContentLoadedEventEnd - perfData.navigationStart;
                    console.log('DOM Content Loaded:', dcl + 'ms');

                    // Performance scoring for development
                    const score = {
                        loadTime: loadTime < 3000 ? '✅' : loadTime < 5000 ? '⚠️' : '❌',
                        ttfb: ttfb < 200 ? '✅' : ttfb < 500 ? '⚠️' : '❌'
                    };
                    console.log('Performance Score:', score);
                }
            }
        });

        // Optional: Google Analytics 4 (GA4) Integration
        // Uncomment and replace GA_MEASUREMENT_ID with your actual ID
        /*
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'GA_MEASUREMENT_ID', {
            // Enhanced measurement for better Core Web Vitals tracking
            custom_map: {'custom_parameter_1': 'lcp_value'},
            send_page_view: true
        });
        */
    </script>

    <!-- Mobile Navigation JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
            const navMenu = document.querySelector('.nav-menu');
            const mobileOverlay = document.querySelector('.mobile-overlay');

            if (mobileMenuToggle && navMenu && mobileOverlay) {
                mobileMenuToggle.addEventListener('click', function() {
                    const isActive = navMenu.classList.contains('active');

                    navMenu.classList.toggle('active');
                    mobileMenuToggle.classList.toggle('active');
                    mobileOverlay.classList.toggle('active');
                    mobileMenuToggle.setAttribute('aria-expanded', !isActive);

                    // Prevent body scrolling when menu is open
                    document.body.style.overflow = isActive ? '' : 'hidden';
                });

                // Close menu when clicking on a link
                const navLinks = navMenu.querySelectorAll('a');
                navLinks.forEach(link => {
                    link.addEventListener('click', function() {
                        navMenu.classList.remove('active');
                        mobileMenuToggle.classList.remove('active');
                        mobileOverlay.classList.remove('active');
                        mobileMenuToggle.setAttribute('aria-expanded', 'false');
                        document.body.style.overflow = '';
                    });
                });

                // Close menu when clicking overlay
                mobileOverlay.addEventListener('click', function() {
                    navMenu.classList.remove('active');
                    mobileMenuToggle.classList.remove('active');
                    mobileOverlay.classList.remove('active');
                    mobileMenuToggle.setAttribute('aria-expanded', 'false');
                    document.body.style.overflow = '';
                });
            }
        });
    </script>
</body>
</html>